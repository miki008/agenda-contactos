<script>

    function crearTablaContactos() {

        limpiar();


        google.script.run
            .withSuccessHandler(crearTablaContactosCorrectamente)
            .withFailureHandler(crearTablaContactosError)
            .obtenerContactos();

    }


    /*  */

    function crearTablaContactosCorrectamente(obj) {
        // eliminarLoader();
        let tabla = document.getElementById("tablaContactos");
        if (tabla) {
            tabla.remove();
        }

        tabla = document.createElement("table");
        tabla.id = "tablaContactos";
        let tablaHeader = document.createElement("thead");
        let tablaBody = document.createElement("tbody");

        // creamos la cabecera
        let primeraFila = document.createElement("tr");
        for (let i = 0; i < obj[0].length; i++) {

            let celda = document.createElement("th");
            celda.textContent = obj[0][i];
            primeraFila.appendChild(celda);

        }
        // agregar columna OPCIONNES
        let celdaOpciones = document.createElement("td");
        celdaOpciones.textContent = 'opciones';
        primeraFila.appendChild(celdaOpciones);
        celdaOpciones.classList.add('text-center');

        // agregar la fila al header de la tabla
        tablaHeader.appendChild(primeraFila);
        tabla.appendChild(tablaHeader);

        // creamos el body de la tabla
        for (let i = 1; i < obj.length; i++) {
            let fila = document.createElement("tr");
            for (let j = 0; j < obj[i].length; j++) {
                let celda = document.createElement("td");
                celda.textContent = obj[i][j];
                fila.appendChild(celda);

                // Si es la columna imagen
                if (j == 5) {
                    celda.textContent = '';
                    let imagen = document.createElement("img");
                    imagen.classList.add("imag-fluid", "rounded");
                    imagen.src = obj[i][j];
                    celda.appendChild(imagen);
                }
            }
            // agregar los botones de la fila
            fila.appendChild(crearCeldaBotones(i + 1, obj[i])); // sumamos uno para borrar la fila correcta ya que la primera fila es la cabecera


            tablaBody.appendChild(fila);
        }


        tabla.appendChild(tablaBody);

        //Agregamos clases de Bootstrap a la tabla

        tabla.classList.add("table", "table-striped", "border", "border-4", "border-dark");

        //Agregamos la tabla a la página

        document.getElementById("divContactos").appendChild(tabla);

        // Mostrar notificación de éxito
        //crearNotificacionOK("Contactos obtenidos correctamente"," Todo en orden");


        // eliminar loader
        eliminarLoader();
    }


    function eliminarTabla() {
        let tabla = document.getElementById("tablaContactos");
        if (tabla) {
            tabla.remove();
        }
    }


    function crearTablaContactosError() {
        // Mostrar notificación de error
        crearNotificacionError("No se han podido obtener los datos", "ERROR");

        // eliminar loader
        eliminarLoader();
    }

    function crearCeldaBotones(numFila,datosContacto){

  // crear celda
  let celda = document.createElement('td');
  celda.classList.add('text-center');

  // crear botón borrar

let botonBorrar = document.createElement('button');
botonBorrar.onclick = () => borrarContacto(numFila);
botonBorrar.classList.add('btn','btn-danger','m-1');

// icono borrar
let iconoBorrar = document.createElement('i');
iconoBorrar.classList.add('bi','bi-trash')
botonBorrar.appendChild(iconoBorrar);

  // crear botón modificar

let botonModificar = document.createElement('button');
botonModificar.onclick = () => abrirModalModificarContacto(numFila,datosContacto);
botonModificar.classList.add('btn','btn-warning','m-1');

// icono Modificar
let iconoModificar = document.createElement('i');
iconoModificar.classList.add('bi','bi-pencil-square')
botonModificar.appendChild(iconoModificar);

// agregar botones a la celda
celda.appendChild(botonBorrar);
celda.appendChild(botonModificar)

return celda;

}

</script>