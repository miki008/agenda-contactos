<script>

    function extraerContactos(datos) {

        let contactos = [];
        for (let i = 1; i < datos.length; i++) {

            let contacto = {
                id: datos[i][0],
                nombre: datos[i][1],
                apellidos: datos[i][2],
                correo: datos[i][3],
                telefono: datos[i][4],
                imagen: datos[i][5],
                fila: i + 1
            };

            contactos.push(contacto);
        }
        return contactos;
    }


    function extraerColumnas(datos) {

        let columnas = [];
        for(let i = 0; i<datos[0].length ; i++){

            columnas.push(datos[0][i])

        }
columnas.push('OPCIONES');
return columnas;

    }


    function crearTablaContactos() {

        limpiar();


        google.script.run
            .withSuccessHandler(crearTablaContactosCorrectamente)
            .withFailureHandler(crearTablaContactosError)
            .obtenerDatos();

    }




    function crearTablaContactosCorrectamente(datos) {


        // extraer contactos y columnas

        let contactos = extraerContactos(datos);
        let columnas = extraerColumnas(datos);

        // crear tabla
        tabla = document.createElement("table");
        tabla.id = "tablaContactos";

        // crear cabecera y agregarla
       tabla.appendChild(crearHeaderTabla(columnas)) ;

       // crear cuerpo y agregar a la tabla
       tabla.appendChild(crearBodyTabla(contactos)) ;

        // estilo de la tabla
         //Agregamos clases de Bootstrap a la tabla

        tabla.classList.add("table", "table-striped", "border", "border-4", "border-dark");


        //Agregamos la tabla a la página

        document.getElementById("divContactos").appendChild(tabla);

        // eliminar loader
        eliminarLoader();
    }


    function eliminarTabla() {
        let tabla = document.getElementById("tablaContactos");
        if (tabla) {
            tabla.remove();
        }
    }


    function crearTablaContactosError() {
        // Mostrar notificación de error
        crearNotificacionError("No se han podido obtener los datos", "ERROR");

        // eliminar loader
        eliminarLoader();
    }



    function crearHeaderTabla(columnas){

        let tablaHeader = document.createElement("thead");
        tablaHeader.classList.add('table-dark');

        // crealmos fila del header de la tabla
        let primeraFila = document.createElement("tr");

        // agregamos las columnas
        columnas.forEach(columna => {

            let celda = document.createElement("th");
            celda.textContent = columna;
            primeraFila.appendChild(celda);
            
        });

        // agregamos fila al header
        tablaHeader.appendChild(primeraFila);

        return tablaHeader;

    }

    function crearBodyTabla(contactos){
        let tablaBody = document.createElement("tbody");

        contactos.forEach(contacto => {

            let fila = document.createElement("tr");

            let celdaId = crearCelda(contacto.id);
            let celdaNombre = crearCelda(contacto.nombre);
            let celdaApellidos = crearCelda(contacto.apellidos);
            let celdaCorreo = crearCelda(contacto.correo);
            let celdaTelefono = crearCelda(contacto.telefono);
            let celdaImagen = crearCeldaImagen(contacto.imagen);

            let celdaBotones = crearCeldaBotones(contacto);

            // agregamos las celdas
            fila.appendChild(celdaId);
            fila.appendChild(celdaNombre);
            fila.appendChild(celdaApellidos);
            fila.appendChild(celdaCorreo);
            fila.appendChild(celdaTelefono);
            fila.appendChild(celdaImagen);
            fila.appendChild(celdaBotones);


            // agregamos la fila

            tablaBody.appendChild(fila);
        
        });

        return tablaBody;

    }

function crearCelda(dato){
        let celda = document.createElement('td');
        //celda.classList.add('text-center');
        celda.textContent = dato;
        
        return celda;

    } 

    function crearCeldaImagen(rutaImagen){

        let celda = document.createElement('td');
        let imagen = document.createElement("img");
        imagen.classList.add("img-fluid", "rounded");
        imagen.src = rutaImagen;
        celda.appendChild(imagen);

        return celda;
    }



    function crearCeldaBotones(contacto) {

        // crear celda
        let celda = document.createElement('td');
        celda.classList.add('text-center');

        // agregar botones a la celda
        celda.appendChild(crearBotonInfoContacto(contacto));
        celda.appendChild(crearBotonBorrarContacto(contacto));
        celda.appendChild(crearBotonModificarContacto(contacto));

        return celda;

    }
 
</script>