<script>

const NOTIFICACON_OK = 1;
const NOTIFICACON_DANGER = 2;
const NOTIFICACON_WARNING = 3;


function crearTablaContactos() {
    const divContactos = document.getElementById("divContactos");
    let tabla = document.getElementById("tablaContactos");
            if (tabla){
                tabla.remove();
            }
    google.script.run
    
    .withSuccessHandler(crearTablaContactosCorrectamente)
    .withFailureHandler(crearTablaContactosError) 
    .obtenerContactos();

   } 


/*  */

function crearTablaContactosCorrectamente(obj){
let tabla = document.getElementById("tablaContactos");
            if (tabla){
                tabla.remove();
            }
          
            tabla = document.createElement("table");
            tabla.id = "tablaContactos";
            let tablaHeader = document.createElement("thead");
            let tablaBody = document.createElement("tbody");

            // creamos la cabecera
            let primeraFila = document.createElement("tr");
            for (let i = 0; i < obj[0].length; i++) {

                let celda = document.createElement("th");
                celda.textContent = obj[0][i];
                primeraFila.appendChild(celda);

            }
            tablaHeader.appendChild(primeraFila);
            tabla.appendChild(tablaHeader);

            // creamos el body de la tabla
            for (let i = 1; i < obj.length; i++) {
                let fila = document.createElement("tr");
                for (let j = 0; j < obj[i].length; j++) {
                    let celda = document.createElement("td");
                    celda.textContent = obj[i][j];
                    fila.appendChild(celda);
                }
                tablaBody.appendChild(fila);
            }


            tabla.appendChild(tablaBody);

            //Agregamos clases de Bootstrap a la tabla

            tabla.classList.add("table", "table-striped","border","border-4","border-dark");

            //Agregamos la tabla a la página

            document.getElementById("divContactos").appendChild(tabla); 
        
            // Mostrar notificación de éxito
            crearNotificacion(NOTIFICACON_OK,"Contactos obtenidos correctamente"," Todo en orden");


        }


        function crearTablaContactosError(err){
            // Mostrar notificación de error
            crearNotificacion(NOTIFICACON_DANGER,"No se han podido obtener los datos" ,"ERROR");
        }

        function crearNotificacion(tipo, mensaje, titulo){

            // obenemos datos
            let mensajeNotificacion = document.getElementById("mensajeNotificacion");
            let tituloNotificacion = document.getElementById("tituloNotificacion");     
            let elementoNotificacion = document.getElementById("notificacion");
            let iconoNotificacion = document.getElementById("iconoNotificacion");   

            let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion); 

            // editar notificación
            mensajeNotificacion.textContent = mensaje;
            tituloNotificacion.textContent = titulo;


            switch(tipo){

                case NOTIFICACON_OK: // éxito
                iconoNotificacion.className = "";
                iconoNotificacion.classList.add("bi", "bi-check2-square");
                elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-oscuro');
                break;

                case NOTIFICACON_DANGER: // error
                iconoNotificacion.className = "";
                iconoNotificacion.classList.add("bi", "bi-bug");
                elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-oscuro');
                break;

                case NOTIFICACON_WARNING: // advertencia
                iconoNotificacion.className = "";
                iconoNotificacion.classList.add("bi", "bi-exclamation-square");
                elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-oscuro');
                break;

            }   

            // mostrar notificación

            notificacion.show();

        }
    </script>